---
import {KNOWN_LANGUAGE_CODES} from '../../../../config';
import {parseWidgetFile} from '../../../../file';

export async function getStaticPaths() {
	const content = await Astro.glob('../../../../content/widgets/**/*.mdx');
	const widgets = new Set<string>();
	for (const page of content) {
		const widgetFile = parseWidgetFile(page.file);
		if (widgetFile === undefined) continue;
		widgets.add(widgetFile.widget);
	}

	return KNOWN_LANGUAGE_CODES.flatMap((language) =>
		Array.from(widgets.values()).map((widget) => ({
			params: {language, widget},
		})),
	);
}
---

<script is:inline>
	let framework = window.localStorage.getItem('framework');
	if (framework === null) {
		framework = 'react';
		window.localStorage.setItem('framework', framework);
	}
	const pathTokens = window.location.pathname
		.split('/')
		.filter((token) => token !== '');
	const language = pathTokens[0];
	const widget = pathTokens.at(-1);
	window.location.pathname = `/${language}/widgets/${widget}/${framework}`;
</script>
