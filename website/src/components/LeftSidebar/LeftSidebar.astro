---
import {parseLanguage} from '../../url';
import {SIDEBAR} from '../../config';
import cx from 'classnames';
import ThemeSwitch from '../Header/ThemeSwitch';
import LanguageSelect from '../Header/LanguageSelect';

type Props = {
	currentPage: string;
};

const {currentPage} = Astro.props as Props;
const currentPageMatch = currentPage.slice(1);
const lang = parseLanguage(currentPage);
const sidebar = SIDEBAR[lang];
---

<nav
	aria-labelledby="grid-left"
	id="sidebar"
	class="max-h-screen px-4 py-8 overflow-y-auto wh-full bg-shade"
>
	<ul class="text-sm">
		{
			Object.entries(sidebar).map(([header, children]) => (
				<li>
					<details class="group" open>
						<summary class="hover:text-accent hover:bg-shade-100 flex items-center justify-between rounded-full p-2 pl-4 font-medium ring-inset">
							<span>{header}</span>
							<span class="group-open:rotate-90">
								<svg
									xmlns="http://www.w3.org/2000/svg"
									class="icon icon-tabler icon-tabler-chevron-right"
									width="24"
									height="24"
									viewBox="0 0 24 24"
									stroke-width="2"
									stroke="currentColor"
									fill="none"
									stroke-linecap="round"
									stroke-linejoin="round"
								>
									<path stroke="none" d="M0 0h24v24H0z" fill="none" />
									<polyline points="9 6 15 12 9 18" />
								</svg>
							</span>
						</summary>
						<ul>
							{children.map((child) => {
								const url = Astro.site?.pathname + child.link;
								return (
									<li>
										<a
											href={url}
											aria-current={
												currentPageMatch === child.link ? 'page' : false
											}
											class={cx(
												'hover:text-accent hover:bg-shade-100 flex rounded-full px-4 py-2 pl-6 ring-inset',
												currentPageMatch === child.link &&
													'text-accent bg-shade-100',
											)}
										>
											{child.text}
										</a>
									</li>
								);
							})}
						</ul>
					</details>
				</li>
			))
		}
	</ul>
	<div
		class="sticky flex gap-2 p-2 mx-auto mt-4 -mb-4 border rounded-full w-fit flex-center -bottom-4 md:hidden bg-shade border-line"
	>
		<ThemeSwitch client:visible />
		<LanguageSelect lang={lang} alwaysShowLabel client:visible />
	</div>
</nav>
