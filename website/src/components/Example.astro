---
import ExampleContainer from './ExampleContainer.svelte';
import type {KNOWN_FRAMEWORKS} from '../config';
import {highlight} from '../utils/highlight';

type Props = {
	sources: Record<string, () => Promise<string>>;
	framework: keyof typeof KNOWN_FRAMEWORKS;
};

const {sources, framework} = Astro.props as Props;

function getFilename(framework: keyof typeof KNOWN_FRAMEWORKS) {
	switch (framework) {
		case 'react':
			return './react.tsx';
		case 'solid':
			return './solid.tsx';
		case 'svelte':
			return './svelte.svelte';
		case 'vue':
			return './vue.vue';
	}
}

const filename = getFilename(framework);
let code = await sources[filename]?.();
if (code === undefined) {
	code = '';
}
code = code.replaceAll('\t', '  ');

const [language, codeHTML] = highlight(code, framework);
---

<ExampleContainer client:idle language={language} codeHTML={codeHTML}>
	{
		framework === 'react' ? (
			<slot name="react" />
		) : framework === 'solid' ? (
			<slot name="solid" />
		) : framework === 'svelte' ? (
			<slot name="svelte" />
		) : framework === 'vue' ? (
			<slot name="vue" />
		) : (
			<>Example not available</>
		)
	}
</ExampleContainer>
